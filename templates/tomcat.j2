#!/bin/bash
#
#https://wiki.debian.org/LSBInitScripts
### BEGIN INIT INFO
# Provides:          tomcat8
# Required-Start:    $local_fs $remote_fs $network
# Required-Stop:     $local_fs $remote_fs $network
# Should-Start:      $named
# Should-Stop:       $named
# Default-Start:     2 3 4 5
# Default-Stop:      0 1 6
# Short-Description: Start Tomcat.
# Description:       Start the Tomcat servlet engine.
### END INIT INFO

export CATALINA_HOME={{ tomcat_dest }}
export JAVA_HOME={{ java_home }}
export PATH=$JAVA_HOME/bin:$PATH

tomcat_pid() {
        echo `ps -fe | grep $CATALINA_HOME | grep -v grep | tr -s " "|cut -d" " -f2`
}


start() {
 pid=$(tomcat_pid)
 echo "Starting Tomcat 8..."
 /bin/su -s /bin/bash tomcat -c $CATALINA_HOME/bin/startup.sh
}
stop() {
 echo "Stopping Tomcat 8..."
 /bin/su -s /bin/bash tomcat -c $CATALINA_HOME/bin/shutdown.sh
}
status(){
        pid=$(tomcat_pid)
        if [ -n "$pid" ]
            then echo "\e[00;32mTomcat is running with pid: $pid\e[00m"
        else
            echo "\e[00;31mTomcat is not running\e[00m"
        return 3
        fi
}
case $1 in
  start|stop|status) $1;;
  restart) stop; start;;
  *) echo "Usage : $0 <start|stop|restart|status>"; exit 1;;
esac

exit 0

# {{ ansible_managed }}